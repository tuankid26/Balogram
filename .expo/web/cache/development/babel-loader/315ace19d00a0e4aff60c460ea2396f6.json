{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\VietAnh\\\\Balogram\\\\screen\\\\NewPostScreen.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useEffect } from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport View from \"react-native-web/dist/exports/View\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport { Text } from 'react-native-paper';\nimport { theme } from \"../components/core/theme\";\nimport { Icon } from 'react-native-elements';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { mediaActions } from \"../redux/actions\";\nimport * as FileSystem from 'expo-file-system';\nimport { BackButton, TextInput } from \"../components\";\nimport { post } from \"../handle_api\";\nimport { token } from \"../handle_api/token\";\nexport default function NewPostScreen(_ref) {\n  var _this = this;\n\n  var navigation = _ref.navigation;\n\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      status = _useState2[0],\n      setStatus = _useState2[1];\n\n  var selectedAssets = useSelector(function (state) {\n    return state.media.selectedAssets;\n  });\n  var dispatch = useDispatch();\n\n  var upLoad = function upLoad() {\n    var imageAssets, videoAssets, convertedImageAssets, convertedVideoAssets, data;\n    return _regeneratorRuntime.async(function upLoad$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            imageAssets = selectedAssets.filter(function (asset) {\n              return asset.mediaType === 'photo';\n            });\n            videoAssets = selectedAssets.filter(function (asset) {\n              return asset.mediaType === 'video';\n            });\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(convertToBase64(imageAssets));\n\n          case 4:\n            convertedImageAssets = _context.sent;\n            _context.next = 7;\n            return _regeneratorRuntime.awrap(convertToBase64(videoAssets));\n\n          case 7:\n            convertedVideoAssets = _context.sent;\n            data = {\n              token: token,\n              described: status,\n              images: convertedImageAssets,\n              videos: convertedVideoAssets\n            };\n            post.addPost(data).then(function (res) {\n              console.log(res.data);\n            }).catch(function (error) {\n              console.log(\"Failed\");\n              console.log(error.response.data);\n            });\n            dispatch(mediaActions.resetState());\n            navigation.navigate(\"MainScreen\");\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var goBack = function goBack() {\n    dispatch(mediaActions.resetState());\n    navigation.navigate(\"MainScreen\");\n  };\n\n  var convertToBase64 = function convertToBase64(assets) {\n    var mimeTypes, assetPromises, convertedAssets, base64Assets;\n    return _regeneratorRuntime.async(function convertToBase64$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            mimeTypes = assets.map(function (asset) {\n              var fileName = asset.filename;\n              var mediaType = asset.mediaType === 'photo' ? 'image' : 'video';\n              var extension = fileName.split('.')[1];\n\n              if (extension === 'jpg') {\n                extension = 'jpeg';\n              }\n\n              return mediaType + \"/\" + extension;\n            });\n            assetPromises = assets.map(function (asset) {\n              return FileSystem.readAsStringAsync(asset.uri, {\n                encoding: FileSystem.EncodingType.Base64\n              });\n            });\n            _context2.next = 4;\n            return _regeneratorRuntime.awrap(Promise.all(assetPromises));\n\n          case 4:\n            convertedAssets = _context2.sent;\n            base64Assets = convertedAssets.map(function (asset, idx) {\n              return formatIntoBase64String(asset, mimeTypes[idx]);\n            });\n            return _context2.abrupt(\"return\", base64Assets);\n\n          case 7:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var formatIntoBase64String = function formatIntoBase64String(data, mediaType) {\n    return \"data:\" + mediaType + \";base64,\" + data;\n  };\n\n  var addImage = function addImage() {\n    navigation.navigate(\"MediaPicker\");\n  };\n\n  var handleRemoveAsset = function handleRemoveAsset(asset) {\n    dispatch(mediaActions.removeAsset(asset));\n  };\n\n  return React.createElement(View, {\n    style: {\n      flex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 5\n    }\n  }, React.createElement(View, {\n    style: styles.headerBar,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }\n  }, React.createElement(View, {\n    style: styles.headerLeft,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 9\n    }\n  }, React.createElement(BackButton, {\n    goBack: goBack,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 11\n    }\n  })), React.createElement(View, {\n    style: styles.headerRight,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }\n  }, React.createElement(Button, {\n    title: \"\\u0110\\u0103ng\",\n    style: styles.upload,\n    onPress: upLoad,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }\n  }))), React.createElement(Text, {\n    style: styles.tus,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  }, \"B\\u1EA1n \\u0111ang ngh\\u0129 g\\xEC?\"), React.createElement(TextInput, {\n    style: styles.status,\n    placeholder: \"Tr\\u1EA1ng th\\xE1i c\\u1EE7a b\\u1EA1n\",\n    returnKeyType: \"next\",\n    onChangeText: setStatus,\n    multiline: true,\n    numberOfLines: 5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }\n  }), React.createElement(Icon, {\n    name: \"image\",\n    type: \"MaterialIcons\",\n    size: 40,\n    color: theme.colors.button,\n    onPress: addImage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }\n  }), React.createElement(View, {\n    style: {\n      flex: 1\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }\n  }, React.createElement(FlatList, {\n    numColumns: 3,\n    data: selectedAssets,\n    renderItem: function renderItem(_ref2) {\n      var item = _ref2.item;\n      return React.createElement(View, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 15\n        }\n      }, React.createElement(ImageBackground, {\n        source: {\n          uri: item.uri\n        },\n        style: styles.image,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 15\n        }\n      }, React.createElement(Icon, {\n        name: \"close\",\n        type: \"ant-design\",\n        size: 16,\n        iconStyle: styles.removeIcon,\n        onPress: function onPress() {\n          return handleRemoveAsset(item);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 17\n        }\n      })));\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }\n  })));\n}\nvar styles = StyleSheet.create({\n  upload: {\n    fontSize: 40,\n    fontWeight: 'bold',\n    marginLeft: 20\n  },\n  tus: {\n    color: \"black\",\n    fontSize: 25,\n    paddingTop: 17,\n    textAlign: \"center\"\n  },\n  status: {\n    margin: 7,\n    fontSize: 20,\n    borderRadius: 6\n  },\n  button: {\n    backgroundColor: theme.colors.button\n  },\n  image: {\n    width: 115,\n    height: 115,\n    margin: 2,\n    borderRadius: 7\n  },\n  headerBar: {\n    height: 40,\n    flexDirection: 'row',\n    alignItems: 'center',\n    backgroundColor: theme.colors.white\n  },\n  headerLeft: {\n    flex: 1\n  },\n  headerRight: {\n    marginRight: 10\n  },\n  removeIcon: {\n    backgroundColor: '#fff',\n    borderRadius: 10,\n    alignSelf: 'flex-end'\n  }\n});","map":{"version":3,"sources":["C:/Users/VietAnh/Balogram/screen/NewPostScreen.js"],"names":["React","useState","useEffect","Text","theme","Icon","useSelector","useDispatch","mediaActions","FileSystem","BackButton","TextInput","post","token","NewPostScreen","navigation","status","setStatus","selectedAssets","state","media","dispatch","upLoad","imageAssets","filter","asset","mediaType","videoAssets","convertToBase64","convertedImageAssets","convertedVideoAssets","data","described","images","videos","addPost","then","res","console","log","catch","error","response","resetState","navigate","goBack","assets","mimeTypes","map","fileName","filename","extension","split","assetPromises","readAsStringAsync","uri","encoding","EncodingType","Base64","Promise","all","convertedAssets","base64Assets","idx","formatIntoBase64String","addImage","handleRemoveAsset","removeAsset","flex","styles","headerBar","headerLeft","headerRight","upload","tus","colors","button","item","image","removeIcon","StyleSheet","create","fontSize","fontWeight","marginLeft","color","paddingTop","textAlign","margin","borderRadius","backgroundColor","width","height","flexDirection","alignItems","white","marginRight","alignSelf"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport { StyleSheet, View, FlatList, Image, Button, TouchableOpacity, ImageBackground  } from 'react-native'\r\nimport { Text } from 'react-native-paper'\r\nimport { theme } from '../components/core/theme'\r\nimport { Icon } from 'react-native-elements'\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { mediaActions } from '../redux/actions';\r\nimport * as FileSystem from 'expo-file-system';\r\n\r\n\r\nimport {\r\n  BackButton,\r\n  TextInput\r\n} from '../components'\r\n\r\nimport {post} from \"../handle_api\";\r\nimport {token} from \"../handle_api/token\"\r\n\r\nexport default function NewPostScreen({ navigation }) {\r\n  const [status, setStatus] = useState(\"\")\r\n\r\n  const selectedAssets = useSelector(state => state.media.selectedAssets);\r\n  const dispatch = useDispatch();\r\n\r\n  const upLoad = async () => {\r\n\r\n    const imageAssets = selectedAssets.filter(asset => asset.mediaType === 'photo');\r\n    const videoAssets = selectedAssets.filter(asset => asset.mediaType === 'video');\r\n    \r\n    const convertedImageAssets = await convertToBase64(imageAssets);\r\n    const convertedVideoAssets = await convertToBase64(videoAssets);\r\n    \r\n    const data = {\r\n      token: token,\r\n      described: status,\r\n      images: convertedImageAssets,\r\n      videos: convertedVideoAssets\r\n    }\r\n\r\n    post.addPost(data)\r\n    .then(res => {\r\n      console.log(res.data);\r\n      // console.log(data.images)\r\n    })\r\n      .catch(error => {\r\n        console.log(\"Failed\");\r\n        console.log(error.response.data);\r\n    })\r\n    dispatch(mediaActions.resetState());\r\n\r\n    navigation.navigate(\"MainScreen\");\r\n\r\n  }\r\n  const goBack = () => {\r\n    dispatch(mediaActions.resetState());\r\n    navigation.navigate(\"MainScreen\");\r\n  }\r\n\r\n  \r\n\r\n\r\n  const convertToBase64 = async (assets) => {\r\n    const mimeTypes = assets.map(asset => {\r\n        const fileName = asset.filename;\r\n        const mediaType = asset.mediaType === 'photo' ? 'image' : 'video';\r\n        let extension = fileName.split('.')[1];\r\n        if (extension === 'jpg') {\r\n            extension = 'jpeg';\r\n        }\r\n\r\n        return `${mediaType}/${extension}`;\r\n    });\r\n\r\n    const assetPromises = assets.map(asset => FileSystem.readAsStringAsync(asset.uri, { encoding: FileSystem.EncodingType.Base64 }));\r\n    const convertedAssets = await Promise.all(assetPromises);\r\n\r\n    const base64Assets = convertedAssets.map((asset, idx) => formatIntoBase64String(asset, mimeTypes[idx]));\r\n    return base64Assets;\r\n}\r\n\r\nconst formatIntoBase64String = (data, mediaType) => {\r\n    return `data:${mediaType};base64,${data}`;\r\n}\r\n\r\n  const addImage = () => {\r\n    navigation.navigate(\"MediaPicker\");\r\n  }\r\n  const handleRemoveAsset = (asset) => {\r\n    dispatch(mediaActions.removeAsset(asset));\r\n  }\r\n\r\n  return (\r\n    <View style={{ flex: 1 }}>\r\n      <View style={styles.headerBar}>\r\n        <View style={styles.headerLeft}>\r\n          <BackButton goBack={goBack} />\r\n        </View>\r\n        <View style={styles.headerRight}>\r\n          {/* <Text style={styles.dang}>Đăng</Text> */}\r\n          <Button title=\"Đăng\" style={styles.upload}\r\n          onPress={upLoad}\r\n          />\r\n        </View>\r\n      </View>\r\n      <Text style={styles.tus}>Bạn đang nghĩ gì?</Text>\r\n      <TextInput style={styles.status}\r\n        placeholder=\"Trạng thái của bạn\"\r\n        returnKeyType=\"next\"\r\n        // value={status}\r\n        onChangeText={setStatus}\r\n        multiline={true}\r\n        numberOfLines={5}\r\n      />\r\n      <Icon name=\"image\" type=\"MaterialIcons\" size={40} color={theme.colors.button} onPress={addImage} />\r\n      {/* Render Image from Gallery */}\r\n\r\n      <View style={{ flex: 1 }}>\r\n        <FlatList\r\n          numColumns={3}\r\n          data={selectedAssets}\r\n          renderItem={({ item }) => (\r\n              <View>\r\n              <ImageBackground \r\n                source={{uri: item.uri}}\r\n                style={styles.image}\r\n              >\r\n                <Icon \r\n                    name='close' \r\n                    type='ant-design' \r\n                    size={16} \r\n                    iconStyle={styles.removeIcon}\r\n                    onPress={() => handleRemoveAsset(item)}\r\n                />\r\n              </ImageBackground>\r\n              </View>\r\n          )\r\n        }/>\r\n      </View>\r\n        \r\n    </View >\r\n  )\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  upload:{\r\n   fontSize: 40,\r\n   fontWeight: 'bold',\r\n   marginLeft: 20\r\n  },\r\n  tus: {\r\n    color: \"black\",\r\n    fontSize: 25,\r\n    paddingTop: 17,\r\n    textAlign: \"center\",\r\n  },\r\n  status: {\r\n    margin: 7,\r\n    fontSize: 20,\r\n    borderRadius: 6,\r\n  },\r\n  button: {\r\n    backgroundColor: theme.colors.button\r\n  },\r\n  image: {\r\n    width: 115,\r\n    height: 115,\r\n    // resizeMode: 'center',\r\n    margin: 2,\r\n    borderRadius: 7,\r\n  },\r\n  headerBar: {\r\n    height: 40,\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    backgroundColor: theme.colors.white,\r\n  },\r\n\r\n  headerLeft: {\r\n    flex: 1,\r\n  },\r\n  headerRight: {\r\n    // justifyContent: 'flex-end',\r\n    // flexDirection: 'row',\r\n    marginRight: 10\r\n  },\r\n  removeIcon: {\r\n    backgroundColor: '#fff', \r\n    borderRadius: 10, \r\n    alignSelf: 'flex-end'\r\n  },\r\n})"]},"metadata":{},"sourceType":"module"}