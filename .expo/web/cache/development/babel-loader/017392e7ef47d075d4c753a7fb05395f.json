{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\VietAnh\\\\Balogram\\\\screen\\\\ChatMessengerScreen.js\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useCallback, useEffect, useLayoutEffect, useRef } from \"react\";\nimport { GiftedChat } from \"react-native-gifted-chat\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport { Avatar, Icon } from \"react-native-elements\";\nimport { io } from \"socket.io-client\";\nimport { chat, message } from \"../handle_api\";\nimport { useSelector, useDispatch } from 'react-redux';\nvar SOCKET_URL = \"http://192.168.0.102:3000\";\nexport default function ChatMessengerScreen(_ref) {\n  var _this = this;\n\n  var route = _ref.route,\n      navigation = _ref.navigation;\n  var socket = useRef();\n  var item = route.params.item;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      messages = _useState2[0],\n      setMessages = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      arrivalMessage = _useState4[0],\n      setArrivalMessage = _useState4[1];\n\n  var chatId = item._id;\n  var token = useSelector(function (state) {\n    return state.authReducer.token;\n  });\n  var receiverId = item.receivedId;\n  var senderId = item.sendId[0];\n\n  var onBack = function onBack() {\n    navigation.navigate(\"MainScreen\");\n  };\n\n  useLayoutEffect(function () {\n    navigation.setOptions({\n      headerLeft: function headerLeft() {\n        return React.createElement(View, {\n          style: styles.headerLeft,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 26,\n            columnNumber: 9\n          }\n        }, React.createElement(Icon, {\n          name: \"chevron-left\",\n          size: 40,\n          onPress: onBack,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 27,\n            columnNumber: 11\n          }\n        }), React.createElement(Avatar, {\n          rounded: true,\n          source: item.avatar,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 28,\n            columnNumber: 11\n          }\n        }));\n      },\n      headerTitle: item.name,\n      headerRight: function headerRight() {\n        return React.createElement(View, {\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 32,\n            columnNumber: 26\n          }\n        }, React.createElement(Icon, {\n          name: \"menu\",\n          size: 40,\n          onPress: function onPress() {\n            return navigation.navigate(\"ChatInformation\", {\n              item: item\n            });\n          },\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 32,\n            columnNumber: 32\n          }\n        }));\n      }\n    });\n  }, [navigation]);\n  useEffect(function () {\n    var initialize = function initialize() {\n      var newMessages;\n      return _regeneratorRuntime.async(function initialize$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(fetchMessages());\n\n            case 2:\n              newMessages = _context.sent;\n              setMessages(newMessages.map(function (msg) {\n                return {\n                  _id: msg._id,\n                  text: msg.content,\n                  createdAt: msg.createdAt,\n                  user: {\n                    _id: msg.user._id,\n                    name: msg.user.username\n                  }\n                };\n              }).reverse());\n              socket.current = io(SOCKET_URL);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    initialize();\n  }, []);\n  useEffect(function () {\n    var _socket$current;\n\n    (_socket$current = socket.current) == null ? void 0 : _socket$current.on('getMessage', function (data) {\n      if (senderId === data.receivedId) {\n        var newMsg = {\n          _id: data._id,\n          text: data.content,\n          createdAt: data.createdAt,\n          user: {\n            _id: data.senderId\n          }\n        };\n        setMessages(function (previousMessages) {\n          return GiftedChat.append(previousMessages, [newMsg]);\n        });\n      }\n    });\n  }, [socket]);\n\n  var fetchMessages = function fetchMessages() {\n    var res;\n    return _regeneratorRuntime.async(function fetchMessages$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(message.getMessages(chatId, token));\n\n          case 3:\n            res = _context2.sent;\n            return _context2.abrupt(\"return\", res.data.data);\n\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(_context2.t0);\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  var _onSend = useCallback(function _callee() {\n    var messages,\n        newMsgObj,\n        sendResult,\n        _args3 = arguments;\n    return _regeneratorRuntime.async(function _callee$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            messages = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : [];\n\n            if (!(messages.length > 0)) {\n              _context3.next = 13;\n              break;\n            }\n\n            newMsgObj = messages[0];\n            _context3.prev = 3;\n            _context3.next = 6;\n            return _regeneratorRuntime.awrap(message.sendMessage(chatId, senderId, receiverId, newMsgObj.text, token));\n\n          case 6:\n            sendResult = _context3.sent;\n            _context3.next = 12;\n            break;\n\n          case 9:\n            _context3.prev = 9;\n            _context3.t0 = _context3[\"catch\"](3);\n            console.log(_context3.t0);\n\n          case 12:\n            setMessages(function (previousMessages) {\n              return GiftedChat.append(previousMessages, messages);\n            });\n\n          case 13:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[3, 9]], Promise);\n  }, []);\n\n  var onDelete = function onDelete(messageIdToDelete) {\n    var deleteMess;\n    return _regeneratorRuntime.async(function onDelete$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            _context4.next = 3;\n            return _regeneratorRuntime.awrap(message.deleteMessage(messageIdToDelete, token));\n\n          case 3:\n            deleteMess = _context4.sent;\n            setMessages(messages.filter(function (message) {\n              return message._id !== messageIdToDelete;\n            }));\n            _context4.next = 10;\n            break;\n\n          case 7:\n            _context4.prev = 7;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n\n          case 10:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  var onLongPress = function onLongPress(context, message) {\n    var options = ['Copy', 'Delete Message', 'Cancel'];\n    var cancelButtonIndex = options.length - 1;\n    context.actionSheet().showActionSheetWithOptions({\n      options: options,\n      cancelButtonIndex: cancelButtonIndex\n    }, function (buttonIndex) {\n      switch (buttonIndex) {\n        case 0:\n          Clipboard.setString(message.text);\n          break;\n\n        case 1:\n          onDelete(message._id);\n          break;\n      }\n    });\n  };\n\n  return React.createElement(GiftedChat, {\n    showAvatarForEveryMessage: true,\n    messages: messages,\n    onSend: function onSend(messages) {\n      return _onSend(messages);\n    },\n    user: {\n      _id: senderId\n    },\n    onLongPress: onLongPress,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 5\n    }\n  });\n}\nvar styles = StyleSheet.create({\n  headerLeft: {\n    flexDirection: \"row\"\n  }\n});","map":{"version":3,"sources":["C:/Users/VietAnh/Balogram/screen/ChatMessengerScreen.js"],"names":["React","useState","useCallback","useEffect","useLayoutEffect","useRef","GiftedChat","Avatar","Icon","io","chat","message","useSelector","useDispatch","SOCKET_URL","ChatMessengerScreen","route","navigation","socket","item","params","messages","setMessages","arrivalMessage","setArrivalMessage","chatId","_id","token","state","authReducer","receiverId","receivedId","senderId","sendId","onBack","navigate","setOptions","headerLeft","styles","avatar","headerTitle","name","headerRight","initialize","fetchMessages","newMessages","map","msg","text","content","createdAt","user","username","reverse","current","on","data","newMsg","previousMessages","append","getMessages","res","console","log","onSend","length","newMsgObj","sendMessage","sendResult","onDelete","messageIdToDelete","deleteMessage","deleteMess","filter","onLongPress","context","options","cancelButtonIndex","actionSheet","showActionSheetWithOptions","buttonIndex","Clipboard","setString","StyleSheet","create","flexDirection"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect, useLayoutEffect, useRef } from \"react\";\r\nimport { GiftedChat } from \"react-native-gifted-chat\";\r\nimport { View, StyleSheet } from \"react-native\";\r\nimport { Avatar, Icon } from \"react-native-elements\";\r\nimport { io } from \"socket.io-client\";\r\nimport { chat, message } from \"../handle_api\";\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nconst SOCKET_URL = \"http://192.168.0.102:3000\";\r\n\r\nexport default function ChatMessengerScreen({ route, navigation }) {\r\n  const socket = useRef();\r\n  const { item } = route.params;\r\n  const [messages, setMessages] = useState([]);\r\n  const [arrivalMessage, setArrivalMessage] = useState(null);\r\n  const chatId = item._id;\r\n  const token = useSelector(state => state.authReducer.token);\r\n  const receiverId = item.receivedId\r\n  const senderId = item.sendId[0]\r\n  const onBack = () => {\r\n    navigation.navigate(\"MainScreen\");\r\n  };\r\n\r\n  useLayoutEffect(() => {\r\n    navigation.setOptions({\r\n      headerLeft: () => (\r\n        <View style={styles.headerLeft}>\r\n          <Icon name={\"chevron-left\"} size={40} onPress={onBack} />\r\n          <Avatar rounded source={item.avatar} />\r\n        </View>\r\n      ),\r\n      headerTitle: item.name,\r\n      headerRight: () => <View><Icon name={\"menu\"} size={40} onPress={() => navigation.navigate(\"ChatInformation\", { item })} /></View>,\r\n    });\r\n  }, [navigation]);\r\n\r\n  useEffect(() => {\r\n    const initialize = async () => {\r\n      const newMessages = await fetchMessages();\r\n      setMessages(\r\n        newMessages.map((msg) => ({\r\n          _id: msg._id,\r\n          text: msg.content,\r\n          createdAt: msg.createdAt,\r\n          user: {\r\n            _id: msg.user._id,\r\n            name: msg.user.username,\r\n          },\r\n        }))\r\n          .reverse()\r\n      );\r\n\r\n\r\n      socket.current = io(SOCKET_URL);\r\n    };\r\n    initialize();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    socket.current?.on('getMessage', (data) => {\r\n      if (senderId === data.receivedId) {\r\n        const newMsg = {\r\n          _id: data._id,\r\n          text: data.content,\r\n          createdAt: data.createdAt,\r\n          user: {\r\n            _id: data.senderId,\r\n          },\r\n        };\r\n\r\n        setMessages((previousMessages) => GiftedChat.append(previousMessages, [newMsg]));\r\n      }\r\n    });\r\n  }, [socket])\r\n\r\n  const fetchMessages = async () => {\r\n    try {\r\n      const res = await message.getMessages(chatId, token);\r\n      return res.data.data;\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  const onSend = useCallback(async (messages = []) => {\r\n    if (messages.length > 0) {\r\n      const newMsgObj = messages[0];\r\n      try {\r\n        const sendResult = await message.sendMessage(\r\n          chatId,\r\n          senderId,\r\n          receiverId,\r\n          newMsgObj.text,\r\n          token\r\n        );\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n      setMessages((previousMessages) =>\r\n        GiftedChat.append(previousMessages, messages)\r\n      );\r\n    }\r\n  }, []);\r\n\r\n  const onDelete = async (messageIdToDelete) => {\r\n    try {\r\n      const deleteMess = await message.deleteMessage(messageIdToDelete, token);\r\n      setMessages(messages.filter(message => message._id !== messageIdToDelete))\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n    // setMessages(messages.filter(message => message._id !== messageIdToDelete) )\r\n  }\r\n\r\n  const onLongPress = (context, message) => {\r\n    const options = ['Copy', 'Delete Message', 'Cancel'];\r\n    const cancelButtonIndex = options.length - 1;\r\n    context.actionSheet().showActionSheetWithOptions({\r\n      options,\r\n      cancelButtonIndex\r\n    }, (buttonIndex) => {\r\n      switch (buttonIndex) {\r\n        case 0:\r\n          Clipboard.setString(message.text);\r\n          break;\r\n        case 1:\r\n          onDelete(message._id) //pass the function here\r\n          break;\r\n      }\r\n    });\r\n  }\r\n\r\n  return (\r\n    <GiftedChat\r\n      showAvatarForEveryMessage={true}\r\n      messages={messages}\r\n      onSend={(messages) => onSend(messages)}\r\n      user={{\r\n        _id: senderId,\r\n      }}\r\n      onLongPress={onLongPress}\r\n    />\r\n  );\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  headerLeft: {\r\n    flexDirection: \"row\",\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}